{% extends "base.html" %}

{% block title %}Админ-панель - Фэнтези Лига Мафии{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h1 class="h3 mb-0">Админ-панель</h1>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle me-2"></i> Добро пожаловать в панель администратора. Здесь вы можете управлять картами, турнирами и пользователями.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Боковое меню -->
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h5 class="mb-0">Меню</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a href="#dashboard" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                        <i class="bi bi-speedometer2 me-2"></i> Дашборд
                    </a>
                    <a href="#cards" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="bi bi-card-list me-2"></i> Управление картами
                    </a>
                    <a href="#tournaments" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="bi bi-trophy me-2"></i> Турниры
                    </a>
                    <a href="#users" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="bi bi-people me-2"></i> Пользователи
                    </a>
                    <a href="#settings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                        <i class="bi bi-gear me-2"></i> Настройки
                    </a>
                    <a href="{{ url_for('index') }}" class="list-group-item list-group-item-action text-primary">
                        <i class="bi bi-arrow-left me-2"></i> Вернуться на сайт
                    </a>
                </div>
            </div>
        </div>

        <!-- Основное содержимое -->
        <div class="col-lg-9">
            <div class="tab-content">
                <!-- Дашборд -->
                <div class="tab-pane fade show active" id="dashboard">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Статистика сайта</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body text-center">
                                            <h1 class="display-4">{{ users|length }}</h1>
                                            <p class="mb-0">Пользователей</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-success text-white">
                                        <div class="card-body text-center">
                                            <h1 class="display-4">{{ cards|length }}</h1>
                                            <p class="mb-0">Карт</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-warning text-dark">
                                        <div class="card-body text-center">
                                            <h1 class="display-4">{{ tournaments|length }}</h1>
                                            <p class="mb-0">Турниров</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-info text-white">
                                        <div class="card-body text-center">
                                            <h1 class="display-4">{{ teams|length }}</h1>
                                            <p class="mb-0">Команд</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Последние действия</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-primary me-2">Регистрация</span>
                                        Новый пользователь: user123
                                    </div>
                                    <span class="text-muted small">5 минут назад</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-success me-2">Покупка</span>
                                        Пользователь player1 купил Золотой пак
                                    </div>
                                    <span class="text-muted small">15 минут назад</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-warning text-dark me-2">Турнир</span>
                                        Завершен турнир "Еженедельный кубок"
                                    </div>
                                    <span class="text-muted small">2 часа назад</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <span class="badge bg-info me-2">Карта</span>
                                        Добавлена новая карта: "Профессионал"
                                    </div>
                                    <span class="text-muted small">3 часа назад</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Управление картами -->
                <div class="tab-pane fade" id="cards">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Управление картами</h5>
                            <a href="{{ url_for('add_card') }}" class="btn btn-sm btn-primary">
                                <i class="bi bi-plus-lg me-1"></i> Добавить карту
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="bi bi-info-circle me-2"></i> Для полного управления картами перейдите в раздел "Карты" в боковом меню.
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Изображение</th>
                                            <th>Имя</th>
                                            <th>Редкость</th>
                                            <th>Прайм</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for card in cards %}
                                        <tr>
                                            <td>{{ card.id }}</td>
                                            <td>
                                                <img src="{{ url_for('static', filename='uploads/' + card.image) }}" 
                                                     alt="{{ card.name }}" width="50" height="50" class="rounded">
                                            </td>
                                            <td>{{ card.name }}</td>
                                            <td>{{ '★' * card.rarity }}</td>
                                            <td>
                                                {% if card.is_prime %}
                                                <span class="badge bg-warning">Да</span>
                                                {% else %}
                                                <span class="badge bg-secondary">Нет</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <a href="{{ url_for('admin_cards') }}" class="btn btn-sm btn-outline-primary">
                                                    <i class="bi bi-card-list"></i> Перейти к управлению
                                                </a>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center py-3">Нет доступных карт</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="mt-3 text-center">
                                <a href="{{ url_for('admin_cards') }}" class="btn btn-primary">
                                    <i class="bi bi-card-list me-2"></i> Перейти к полному управлению картами
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Турниры -->
                <div class="tab-pane fade" id="tournaments">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Управление турнирами</h5>
                            <small class="text-muted">Функционал в разработке</small>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Название</th>
                                            <th>Дата начала</th>
                                            <th>Дата окончания</th>
                                            <th>Статус</th>
                                            <th>Участники</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for tournament in tournaments %}
                                        <tr>
                                            <td>{{ tournament.id }}</td>
                                            <td>{{ tournament.name }}</td>
                                            <td>{{ tournament.start_time }}</td>
                                            <td>{{ tournament.end_time }}</td>
                                            <td>
                                                {% if tournament.is_active %}
                                                <span class="badge bg-success">Активен</span>
                                                {% else %}
                                                <span class="badge bg-secondary">Завершен</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ tournament.participants }}</td>
                                            <td>
                                                <span class="badge bg-secondary">Функционал в разработке</span>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">Нет доступных турниров</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="alert alert-info mt-3">
                                <i class="bi bi-info-circle me-2"></i> Функционал управления турнирами находится в разработке.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Пользователи -->
                <div class="tab-pane fade" id="users">
                    <div class="card shadow-sm mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">Управление пользователями</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <i class="bi bi-info-circle me-2"></i> Список всех зарегистрированных пользователей сайта.
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Имя пользователя</th>
                                            <th>Email</th>
                                            <th>Монеты</th>
                                            <th>Очки</th>
                                            <th>Карты</th>
                                            <th>Действия</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for user in users %}
                                        <tr>
                                            <td>{{ user.id }}</td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <img src="{{ url_for('static', filename='images/avatars/' + user.avatar) }}" 
                                                         alt="Аватар" class="rounded-circle me-2" width="32" height="32">
                                                    {{ user.username }}
                                                </div>
                                            </td>
                                            <td>{{ user.email }}</td>
                                            <td>{{ user.coins }}</td>
                                            <td>{{ user.points }}</td>
                                            <td>{{ user.cards|length }}</td>
                                            <td>
                                                <span class="badge bg-secondary">Нет действий</span>
                                            </td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td colspan="7" class="text-center py-3">Нет доступных пользователей</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Пагинация удалена, так как не функционирует -->
                        </div>
                    </div>
                </div>

                <!-- Настройки -->
                <div class="tab-pane fade" id="settings">
                    <div class="card shadow-sm">
                        <div class="card-header">
                            <h5 class="mb-0">Настройки сайта</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle me-2"></i> Настройки сайта пока недоступны. Функционал находится в разработке.
                            </div>
                            <div class="text-center py-4">
                                <i class="bi bi-gear" style="font-size: 3rem; opacity: 0.5;"></i>
                                <p class="mt-3 text-muted">Раздел настроек будет доступен в следующих обновлениях.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
